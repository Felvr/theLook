theLook

Сколько всего пользователей зарегестрировано в системе?
Всего users 100к я нашел с помошью следующего запроса:
	select count(*) from users u 
Но если мы проверим количество уникальных почтовых ящиков, то цифра измениться(84k), от сюда можнотвыдвинуть предположение, что у одного человека может быть нескольок аккаунтов:
	select count(distinct(email)) from users u
При этом нельзя смотреть по уникальности имени фамилии, так как могут быть люди у которых одинаковые имена и фамилии:
	select count(distinct(first_name, last_name)) from users u

Какое общее количество заказов было совершенно за все время?
Всего было совершенно примерно 125k заказов, значит скорее всего каждый юзер хотя бы раз заказывал на платформе theLook
	select count(*) from orders o 

Какое количество товаров представленно в магазине?
В таблице inventory_items расписан каждый товар, но уникальных всего 29k:
	select count(distinct (product_id)) from inventory_items ii 

За какой период доступны данные о заказах?
Для этого найдем максимальное и миниальное значение и вычислим разницу, 
получилось c 2019-01-06 по 2024-01-17:
	select max(created_at) from orders
	select min(created_at) from orders

Количество заказов за месяц.
Для решения данной задачи отсечем в датах все кроме месяца и сгрпируем по этим показателям, посчитаем кол-во заказов за месяц и отсортируем по прибыли:
	select date_trunc('month', created_at) as date,
	count(distinct order_id) as number_of_orders,
	sum(sale_price) as sum_of_orders
	from order_items oi 
	group by date
	order by sum_of_orders ;
Получилось увидеть стабильный рост количества заказов и прибыли каждый месяц, только в 21 году заметен небольшой спад, скорее всего свзяаный с домашней изоляцией.

Прибыль за каждый месяц.
Для того чтобы посчитать прибыль за месяц мы присоединим таблицу с описанием товара и от туда возьмем стоимость каждого товара, затем вычтем из выручки, которую мы нашли в прошлом пункте:
	select date_trunc('month', created_at) as date,
	count(distinct order_id) as number,
	sum(oi.sale_price) as revenue,
	sum(oi.sale_price - p."cost") as profit
	from order_items oi join products p on oi.product_id = p.id 
	group by date
	order by profit;
Прибыль также как и выручка увеличивается пропорционально с каждыйм месяцом и составляет примерно 50% от выручки.

Средний чек за месяц.
Делем общую выручку на количество заказов для того, чтобы узнать средний чек покупок за месяц:
	select date_trunc('month', created_at) as date,
	count(distinct order_id) as number,
	sum(oi.sale_price) as revenue,
	sum(oi.sale_price) / count(distinct order_id) as avg_account
	from order_items oi join products p on oi.product_id = p.id 
	group by date
	order by avg_account;
Средний чек получился не зависящим от этапов развития магазина с течением времени и варьируется примерно от 80-90 доларов и только в одном месяце был выброс в 100 доларов, от сюда можно сделать предположение, что цены в магазине остаются все время примерно на одном уровне, но для подтверждения гипотезы надо провести дополнительные иследования.

10 самых лояльных покупателей по количеству заказов.
Группируем заказы по людям и считаем количество:
	select user_id,
	count (order_id) as count_of_orders
	from orders
	group by user_id 
	order by count_of_orders desc
	limit 10
Выборка была не совсем правдоподобная поэтому большинство пользователей делали 4 заказа, либо у нас в магазине продаются товары, которые не надо покупать часто или в больших количествах. Но так как по условию у нам магазин продает различные товары, то скорее всего это произошло из-за того, что датасет синтетический.

Cколько уникальных пользователей было на каждом этапе воронки: product, cart, purchase.
Есть два варианта считать по уникальным пользователям и считать по уникальным ip, но один пользователь может заходить с разных устройств, а также не все посетители могут иметь собственный аккаунт. Поэтому надо уникальное решение для этой задачи. Но так как задание посчиатть уникальныз пользователей, то так и сдеалем:
	select count(distinct e.user_id),
	event_type
	from events e 
	group by e.event_type
Оказадось примерное равное количество пользователей на каждом этапе сделки, но если посчитать уникальные ip то получится гараздо большое количетсво заказов, как и ожидалось. А также разница между каждым из этапов сильно изменилась, кроме финальных этапов, из чего можно сделать вывод, что офромить заказ без аккаунта на сайте не возможно. 